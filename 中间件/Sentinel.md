##### 常见限流方法

```
1、滑动窗口(https://media.pearsoncmg.com/aw/ecs_kurose_compnetwork_7/cw/content/interactiveanimations/selective-repeat-protocol/index.html)
发送和接受方都会维护一个数据帧的序列，这个序列被称作窗口。发送方的窗口大小由接受方确定，目的在于控制发送速度，以免接受方的缓存不够大，而导致溢出，同时控制流量也可以避免网络拥塞。
2、计数器
简单计数的方式
3、漏桶（控制传输速率Leaky bucket）
漏桶算法思路是，不断的往桶里面注水，无论注水的速度是大还是小，桶都是按固定的速率往外漏水；如果桶满了,水会溢出；
在桶满水之后，
常见的处理方式为：暂时拦截住上方水的向下流动，等待桶中的一部分水漏走后，再放行上方水。溢出的上方水直接抛弃。
特点：漏水的速率是固定的；即使存在突然注水量变大的情况，漏水的速率也是固定的
4、令牌桶(能够解决突发流量)
令牌桶算法是网络流量整形（Traffic Shaping）和速率限制（Rate Limiting）中最常使用的一种算法。典型情况下，令牌桶算法用来控制发送到网络上的数据的数目，并允许突发数据的发送。
令牌桶是一个存放固定容量令牌（token）的桶，按照固定速率往桶里添加令牌; 令牌桶算法实际上由三部分组成：两个流和一个桶，分别是令牌流、数据流和令牌桶
```
##### 常见限流方案
```
semphore、Guava(RateLimiter令牌桶/漏桶)、Redisson(RRateLimiter令牌桶)、Alibaba Sentinel
```
##### 流量控制手段-三种拒绝策略
```
直接拒绝：当QPS超过任意规则的阈值后，新的请求就会被立即拒绝，拒绝方式为抛出FlowException
Warm Up：预热/冷启动方式，当系统长期处于低并发的情况下，流量突然增加到qps的最高峰值，可能会造成系统的瞬间流量过大把系统压垮。所以warmup，相当于处理请求的数量是缓慢增加
匀速排队：严格控制请求通过的间隔时间，也即是让请求以均匀的速度通过，对应的是漏桶算法
。对应FlowRule中的controlBehavior 字段
```
##### Sentinel熔断降级-三种降级模式
```
Sentinel 熔断降级会在调用链路中某个资源出现不稳定状态时(例如调用超时或异常比例升高)，对这个资源的调用进行限制，让请求快速失败，避免影响到其它的资源而导致级联错误。当资源被降级后，
在接下来的降级时间窗口之内，对该资源的调用都自动熔断
那么怎么去判断资源是否处于稳定状态呢？
1. 平均响应时间，比如，在1s内连续处理5个请求，它的平均响应时间都超过阈值，那么在后续的时间窗口中，对于这个方法的调用都会自动熔断，sentinel默认的平均响应时间是4900ms
2. 异常比例，当指定资源每秒请求量大于等于5，并且每秒的异常总数占通过量的比值超过阈值之后（比如每秒处理1000个请求,其中异常请求数为500，那么当前的比值是50%），那么该资源会进入降级状态。异常的比率范围是[0.0,1.0]表示0%到100%
3. 异常数，当资源在1分钟的异常数据超过阈值后会进行熔断
```
